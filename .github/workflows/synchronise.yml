name: 'Synchronise Releases'
on: 
  workflow_dispatch
jobs:
  synchronisation:
    runs-on: ubuntu-latest
    outputs:
      tagname: ${{ steps.release.outputs.TAGNAME }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.1
      - name: Setup node
        uses: actions/setup-node@v4.0.2
        with:
          node-version: 18.17.x
          cache: npm
      - name: Install
        run: npm install
      - name: Sync
        id: release
        env:
          TOKEN: ${{ secrets.CREATE_RELEASE_TOKEN }}
        run: |
          TAG=`node ./sync_releases.js $TOKEN | tr -d "v"`
          echo $TAG
          echo "TAGNAME=$TAG" >> "$GITHUB_OUTPUT"
  call_workflow:
    needs: synchronisation
    if: ${{ needs.synchronisation.outputs.tagname != 'none' }}
    uses: ./.github/workflows/generate.yml
    with:
      version: ${{ needs.synchronisation.outputs.tagname }}
          
